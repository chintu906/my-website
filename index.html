<script>

let conversationHistory = [];

function getAIResponse(message) {
  message = message.toLowerCase().trim();

  conversationHistory.push(message);

  // Greeting
  if (message.includes("hello") || message.includes("hi")) {
    return "Hello Dhanush! ğŸ‘‹ Ask me anything!";
  }

  // Remember name
  if (message.includes("my name is")) {
    let name = message.replace("my name is", "").trim();
    localStorage.setItem("username", name);
    return "Nice to meet you, " + name + " ğŸ˜Š I will remember your name!";
  }

  // Recall name
  if (message.includes("what is my name")) {
    let name = localStorage.getItem("username");
    if (name) {
      return "Your name is " + name + " ğŸ˜„";
    } else {
      return "I don't know your name yet. Tell me using 'my name is ...'";
    }
  }

  // Repeat last message
  if (message.includes("what did i say")) {
    if (conversationHistory.length > 1) {
      return "Earlier you said: \"" + conversationHistory[conversationHistory.length - 2] + "\"";
    } else {
      return "This is your first message.";
    }
  }

  // Simple math
  if (/^[0-9+\-*/(). ]+$/.test(message)) {
    try {
      return "Answer: " + Function('"use strict";return (' + message + ')')();
    } catch {
      return "Calculation error.";
    }
  }

  if (message.includes("math")) {
    return "Math is about numbers and solving problems. Try 5+5.";
  }

  return "Interesting! Tell me more ğŸ˜Š";
}

function addMessage(text, sender) {
  const chatBox = document.getElementById("chatBox");

  const messageDiv = document.createElement("div");
  messageDiv.className = sender;

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.textContent = text;

  messageDiv.appendChild(bubble);
  chatBox.appendChild(messageDiv);

  chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage() {
  const input = document.getElementById("userInput");
  const message = input.value.trim();
  if (!message) return;

  addMessage(message, "user");
  input.value = "";

  setTimeout(() => {
    const reply = getAIResponse(message);
    addMessage(reply, "ai");
  }, 500);
}

</script>
